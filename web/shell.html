<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Last Stand - Tower Defense</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            background: #1a1a2e;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            color: #e0e0e0;
        }
        h1 {
            margin-bottom: 16px;
            font-size: 1.5rem;
            color: #e0e0e0;
        }
        #canvas-container {
            border: 2px solid #333;
            border-radius: 4px;
            overflow: hidden;
        }
        canvas { display: block; }
        #loading {
            margin-top: 20px;
            text-align: center;
        }
        #loading .spinner {
            font-size: 0.9rem;
            color: #aaa;
        }
        #progress-bar {
            width: 300px;
            height: 8px;
            background: #333;
            border-radius: 4px;
            margin-top: 8px;
            overflow: hidden;
        }
        #progress-bar #progress {
            width: 0%;
            height: 100%;
            background: #4a9eff;
            transition: width 0.2s;
        }
    </style>
</head>
<body>
    <h1>Last Stand</h1>
    <div id="canvas-container">
        <canvas id="canvas" oncontextmenu="event.preventDefault()" tabindex="-1"></canvas>
    </div>
    <div id="loading">
        <div class="spinner" id="status">Downloading...</div>
        <div id="progress-bar"><div id="progress"></div></div>
    </div>

    <script>
        var Module = {
            canvas: (function() { return document.getElementById('canvas'); })(),
            setStatus: function(text) {
                var statusEl = document.getElementById('status');
                var progressEl = document.getElementById('progress');
                var loadingEl = document.getElementById('loading');
                if (!text) {
                    loadingEl.style.display = 'none';
                    return;
                }
                statusEl.textContent = text;
                var m = text.match(/([^(]+)\((\d+(\.\d+)?)\/(\d+)\)/);
                if (m) {
                    var pct = (parseInt(m[2]) / parseInt(m[4])) * 100;
                    progressEl.style.width = pct + '%';
                }
            },
            totalDependencies: 0,
            monitorRunDependencies: function(left) {
                this.totalDependencies = Math.max(this.totalDependencies, left);
                Module.setStatus(left
                    ? 'Preparing... (' + (this.totalDependencies - left) + '/' + this.totalDependencies + ')'
                    : 'All downloads complete.');
            }
        };
        Module.setStatus('Downloading...');
        window.onerror = function() {
            Module.setStatus('Error! See browser console for details.');
        };

        // Resume AudioContext on first user interaction (browser autoplay policy).
        // Raylib uses miniaudio which stores its Web Audio contexts in Module.miniaudio.
        function resumeAudio() {
            if (typeof Module !== 'undefined' && typeof Module.miniaudio !== 'undefined') {
                for (var i = 0; i < Module.miniaudio.devices.length; i++) {
                    if (Module.miniaudio.devices[i] != null) {
                        Module.miniaudio.devices[i].webaudio.resume();
                    }
                }
            }
            document.removeEventListener('click', resumeAudio);
            document.removeEventListener('keydown', resumeAudio);
            document.removeEventListener('touchstart', resumeAudio);
        }
        document.addEventListener('click', resumeAudio);
        document.addEventListener('keydown', resumeAudio);
        document.addEventListener('touchstart', resumeAudio);
    </script>
    {{{ SCRIPT }}}
</body>
</html>
